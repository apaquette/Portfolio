@inject NavigationManager Nav

<nav  style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
    <ol class="breadcrumb">
        @foreach(var crumb in Breadcrumbs){
            if(crumb.IsActive){
                <li class="breadcrumb-item active"> @crumb.Text</li>
            }else{
                <li class="breadcrumb-item">
                    <a href="@crumb.Url">@crumb.Text</a>
                </li>
            }
        }
    </ol>
</nav>

@code{
    private List<BreadcrumbItem> Breadcrumbs = [];

    protected override void OnInitialized()
    {
        Nav.LocationChanged += (_, __) => BuildBreadCrumbs();
        BuildBreadCrumbs();
    }

    private void BuildBreadCrumbs()
    {
        Breadcrumbs.Clear();

        string? uri = Nav.Uri.Replace(Nav.BaseUri, "").Trim('/');
        string[]? segments = uri.Split("/", StringSplitOptions.RemoveEmptyEntries);


        // Always start with home
        Breadcrumbs.Add(new(){
            Text = "Home",
            Url = "/",
            IsActive = segments.Length == 0
        });

        if (segments.Length > 0 && segments[0].Equals("projects", StringComparison.OrdinalIgnoreCase))
        {
            Breadcrumbs.Add(new ()
            {
                Text = "Projects",
                Url = "/projects",
                IsActive = segments.Length == 1
            });
        }

        if (segments.Length > 1)
        {
            // Use the project slug as the name
            string projectName = Uri.UnescapeDataString(segments[1]);

            Breadcrumbs.Add(new()
            {
                Text = projectName,
                Url = $"/projects/{segments[1]}",
                IsActive = true
            });
        }

        StateHasChanged();
    }

    private class BreadcrumbItem
    {
        public string Text { get; set; } = "";
        public string Url { get; set;} = "";
        public bool IsActive { get; set; }
    }
}